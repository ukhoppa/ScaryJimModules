------------------------------------------------------------
-- HorseModule (RockModule-style)
------------------------------------------------------------
local HorseModule = {}

-- Storage
HorseModule.Tiers = {}       -- Not used like RockModule but keeps API similar
HorseModule.Horses = {}      -- All horses on the current island
HorseModule.UpdateListeners = {}

-- Helper: Scan all horses in the workspace
function HorseModule.ScanHorses()
    local horses = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("HumanoidRootPart") then
            local horseData = {
                instance = obj,
                breed = obj:FindFirstChild("Breed") and obj.Breed.Value or "Unknown",
                colour = obj:FindFirstChild("Color") and obj.Color.Value or "Unknown",
                mane = obj:FindFirstChild("Mane") and obj.Mane.Value or "Unknown",
                tail = obj:FindFirstChild("Tail") and obj.Tail.Value or "Unknown",
            }
            table.insert(horses, horseData)
        end
    end
    HorseModule.Horses = horses
    HorseModule._fireUpdate()
    return horses
end

-- Internal: notify listeners
function HorseModule._fireUpdate()
    for _, callback in ipairs(HorseModule.UpdateListeners) do
        pcall(function()
            callback(HorseModule.Horses)
        end)
    end
end

-- External API: OnUpdate
function HorseModule.OnUpdate(callback)
    table.insert(HorseModule.UpdateListeners, callback)
end

-- Optional: auto-scan loop to detect new/despawned horses
HorseModule.AutoScan = false
function HorseModule.ToggleAutoScan(value)
    HorseModule.AutoScan = value
    if value then
        spawn(function()
            while HorseModule.AutoScan do
                HorseModule.ScanHorses()
                task.wait(2) -- scan every 2 seconds
            end
        end)
    end
end

return HorseModule
